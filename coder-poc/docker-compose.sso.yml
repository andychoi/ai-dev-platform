# SSO Configuration Override
# Use with: docker compose -f docker-compose.yml -f docker-compose.sso.yml up -d

services:
  coder:
    environment:
      # Authentik OIDC
      CODER_OIDC_ISSUER_URL: "http://authentik-server:9000/application/o/coder/"
      CODER_OIDC_CLIENT_ID: "coder"
      CODER_OIDC_CLIENT_SECRET: "x9XPxAr97r59IwvlhgO8ZwpH89BddDMvzP3otPwpRDgFcPQX7weaIfNDclpYHLA0ZDgrOkdvyRHzNBhB7OD7XuJ9Zcs3zK3tzXy3CGXi2JjwpHQdoCvsP91fkHjvSxBg"
      CODER_OIDC_ALLOW_SIGNUPS: "true"
      CODER_OIDC_EMAIL_DOMAIN: ""
      # Disable default GitHub OAuth (device flow)
      CODER_OAUTH2_GITHUB_DEFAULT_PROVIDER_ENABLE: "false"
      # Keep local login as fallback
      CODER_DISABLE_PASSWORD_AUTH: "false"

  minio:
    environment:
      # Authentik OIDC
      MINIO_IDENTITY_OPENID_CONFIG_URL: "http://authentik-server:9000/application/o/minio/.well-known/openid-configuration"
      MINIO_IDENTITY_OPENID_CLIENT_ID: "minio"
      MINIO_IDENTITY_OPENID_CLIENT_SECRET: "p2NGu8MWCPi5DF1udAT5AQ39lby3ykLq97xqDbOHWyiThaW2vtzcYdIYGAM1QCbjKdjyYUvARWn9SzQ38DBYSyaLHXlUfQ2NGV1qILDyIMXjQK778jfji2q4CaJFACNO"
      MINIO_IDENTITY_OPENID_CLAIM_NAME: "policy"
      MINIO_IDENTITY_OPENID_SCOPES: "openid,profile,email"
      MINIO_IDENTITY_OPENID_REDIRECT_URI: "http://localhost:9001/oauth_callback"

  platform-admin:
    environment:
      # Authentik OIDC
      OIDC_ENABLED: "true"
      OIDC_ISSUER_URL: "http://authentik-server:9000/application/o/platform-admin/"
      OIDC_CLIENT_ID: "platform-admin"
      OIDC_CLIENT_SECRET: "RILYoU8R30l8DCC1kl2GQGcKBC3aB9xsef1TnqCidVo0P3O7GF31rvqMmYFiAh5hDmz8I1IJxnDHzb2DK8us9t6HFxQUUzsHzUMIc36VmXk7QVIWcylye52v1rC5kpMk"
      LOCAL_AUTH_ENABLED: "true"
