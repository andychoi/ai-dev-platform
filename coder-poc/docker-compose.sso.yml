# SSO Configuration Override
# Use with: docker compose -f docker-compose.yml -f docker-compose.sso.yml up -d

services:
  coder:
    environment:
      # Authentik OIDC
      CODER_OIDC_ISSUER_URL: "http://host.docker.internal:9000/application/o/coder/"
      CODER_OIDC_CLIENT_ID: "coder"
      CODER_OIDC_CLIENT_SECRET: "YG1Zk9mDp71a13XBNJs04ylFcwBYzzLpNkd2GNf875GcBsjDLb4HfoCIDMP6LaqLUYRvAcKqTfagQA9rRwF5YkxSzIcEjf7aV2y49HROQgVv29gn3kNV9AfEaCNDguVS"
      CODER_OIDC_ALLOW_SIGNUPS: "true"
      CODER_OIDC_EMAIL_DOMAIN: ""
      # Disable default GitHub OAuth (device flow)
      CODER_OAUTH2_GITHUB_DEFAULT_PROVIDER_ENABLE: "false"
      # Keep local login as fallback
      CODER_DISABLE_PASSWORD_AUTH: "false"

  minio:
    environment:
      # Authentik OIDC
      MINIO_IDENTITY_OPENID_CONFIG_URL: "http://host.docker.internal:9000/application/o/minio/.well-known/openid-configuration"
      MINIO_IDENTITY_OPENID_CLIENT_ID: "minio"
      MINIO_IDENTITY_OPENID_CLIENT_SECRET: "VQd0HBCbrCxHLRcw5xzV2jTSx4Fwq8GbCSKus14aDrYVkaK0qme3JBytXAIJs0RY48MtP9Dn5XUsSqLSOaNSsCEs6X7OEAONNYJxYlEFoy6JHvdqCOrECC1sKZPi5IPj"
      MINIO_IDENTITY_OPENID_CLAIM_NAME: "policy"
      MINIO_IDENTITY_OPENID_SCOPES: "openid,profile,email"
      MINIO_IDENTITY_OPENID_REDIRECT_URI: "http://localhost:9001/oauth_callback"

  platform-admin:
    environment:
      # Authentik OIDC
      OIDC_ENABLED: "true"
      OIDC_ISSUER_URL: "http://host.docker.internal:9000/application/o/platform-admin/"
      OIDC_CLIENT_ID: ""
      OIDC_CLIENT_SECRET: ""
      LOCAL_AUTH_ENABLED: "true"
